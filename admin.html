<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Beritakan</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts & Styles (Sama seperti kode Anda) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 0.5rem; color: white; font-weight: 600; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transform: translateX(100%); transition: opacity 0.3s ease, transform 0.3s ease; z-index: 100; }
        .notification.show { opacity: 1; transform: translateX(0); }
        .notification.success { background-color: #28a745; }
        .notification.error { background-color: #dc3545; }
    </style>

    <!-- Tailwind Config (Sama seperti kode Anda) -->
    <script>
        tailwind.config = { theme: { extend: { colors: { beritakanRed: '#D32F2F', beritakanRedHover: '#B71C1C' } } } }
    </script>
</head>

<body class="bg-gray-100">

    <main id="admin-panel" class="container mx-auto max-w-4xl p-4 sm:p-6 hidden">
        <header class="mb-8 pb-4 border-b border-gray-300">
            <h1 class="text-3xl font-extrabold text-beritakanRed">üõ†Ô∏è Admin Panel - Beritakan</h1>
            <p class="text-gray-600 mt-1">Gunakan form di bawah ini untuk menambah berita baru.</p>
        </header>

        <!-- ===== BAGIAN BARU: KONFIGURASI INTEGRASI ===== -->
        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg shadow-sm mb-8">
            <h3 class="text-lg font-bold text-blue-800 mb-2">Konfigurasi Integrasi</h3>
            <p class="text-sm text-blue-700 mb-3">Simpan URL di sini agar tidak perlu mengedit kode lagi. Biarkan kosong jika tidak ingin digunakan.</p>
            <div class="space-y-3">
                <div>
                    <label for="gscript-url-input" class="block text-sm font-medium text-gray-700">URL Web App Google Sheet</label>
                    <input type="url" id="gscript-url-input" placeholder="Salin & tempel URL Web App Anda dari Google" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                 <div>
                    <label for="n8n-url-input" class="block text-sm font-medium text-gray-700">URL Webhook n8n (Opsional)</label>
                    <input type="url" id="n8n-url-input" placeholder="Salin & tempel URL webhook n8n" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
             <button id="save-urls-btn" class="mt-4 bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">Simpan URL</button>
        </div>
        
        <!-- Form input berita (HTML sama seperti kode Anda) -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8"><h2 class="text-2xl font-bold text-gray-800 mb-6">Input Berita Baru</h2><form id="news-form" class="space-y-5"><div><label for="judul" class="block text-sm font-medium text-gray-700 mb-1">Judul Berita</label><input type="text" id="judul" name="judul" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="tanggal" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Publikasi</label><input type="date" id="tanggal" name="tanggal" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed"></div><div><label for="kategori" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label><select id="kategori" name="kategori" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed"><option>Teknologi</option><option>Politik</option><option>Gaya Hidup</option><option>Hiburan</option><option>Olahraga</option></select></div></div><div><label for="ringkasan" class="block text-sm font-medium text-gray-700 mb-1">Ringkasan (Summary)</label><textarea id="ringkasan" name="ringkasan" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed"></textarea></div><div><label for="isi" class="block text-sm font-medium text-gray-700 mb-1">Isi Berita Lengkap</label><textarea id="isi" name="isi" rows="7" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed" placeholder="Anda bisa menggunakan tag HTML sederhana seperti <p>, <b>, <i>, <ul>, <li>"></textarea></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center"><div><label for="thumbnail" class="block text-sm font-medium text-gray-700 mb-1">URL Gambar Thumbnail</label><input type="url" id="thumbnail" name="thumbnail" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-beritakanRed focus:border-beritakanRed" placeholder="https://contoh.com/gambar.jpg"></div><div class="pt-6"><label for="trending" class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="trending" name="trending" class="h-5 w-5 rounded border-gray-300 text-beritakanRed focus:ring-beritakanRed"><span class="text-sm font-medium text-gray-700">Jadikan Berita Trending? üî•</span></label></div></div><div class="flex items-center gap-4 pt-4 border-t border-gray-200"><button type="submit" id="submit-btn" class="bg-beritakanRed text-white font-bold py-2 px-6 rounded-md hover:bg-beritakanRedHover transition-colors flex items-center gap-2"><span id="submit-text">+ Tambah Berita</span><div id="submit-spinner" class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin hidden"></div></button><button type="button" id="reset-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-600 transition-colors">üîÅ Reset Form</button></div></form></div>
        <div class="bg-white p-6 rounded-lg shadow-md"><h2 class="text-2xl font-bold text-gray-800 mb-4">Daftar Berita</h2><p class="text-gray-500">Fitur daftar berita akan dikelola langsung melalui Google Sheet atau database backend Anda.</p><div class="overflow-x-auto mt-4"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Judul</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"><tr><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Contoh Berita...</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Teknologi</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Tersimpan</td></tr></tbody></table></div></div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ===== BAGIAN KONFIGURASI & KEAMANAN =====
        const ADMIN_PASSWORD_HASH = 'a654b5de0f6e04a97f4c238dafd62f21651453175e1b212adf8917a516c55279';
        const GSCRIPT_URL_KEY = 'https://script.google.com/macros/s/AKfycbyTITgQO1bSxa57fRGzUAuGtJhg2UCClIR8rSveiHoaS-78R0SkeRaTIDS_ucPNnOf-UQ/exec';
        const N8N_URL_KEY = 'https://rested-on-bullfrog.ngrok-free.app/webhook/beritakan-input';

        async function sha256(message) { /* ... fungsi sha256 sama ... */ const msgBuffer = new TextEncoder().encode(message); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); }
        async function authenticate() { /* ... fungsi authenticate sama ... */ const password = prompt("Masukkan password admin:"); if (!password) { document.body.innerHTML = '<h1 class="text-center text-2xl font-bold mt-10 text-red-600">Akses Dibatalkan</h1>'; return; } const inputHash = await sha256(password); if (inputHash === ADMIN_PASSWORD_HASH) { document.getElementById('admin-panel').classList.remove('hidden'); loadUrls(); } else { alert("Password salah! Akses ditolak."); document.body.innerHTML = '<h1 class="text-center text-2xl font-bold mt-10 text-red-600">Akses Ditolak</h1>'; } }
        
        // ===== BAGIAN FUNGSI FORM & APLIKASI (DIPERBARUI) =====
        const newsForm = document.getElementById('news-form');
        const submitBtn = document.getElementById('submit-btn');
        const saveUrlsBtn = document.getElementById('save-urls-btn');
        const gscriptUrlInput = document.getElementById('gscript-url-input');
        const n8nUrlInput = document.getElementById('n8n-url-input');

        function showNotification(message, type = 'success') { /* ... fungsi notifikasi sama ... */ const notification = document.createElement('div'); notification.className = `notification ${type}`; notification.textContent = message; document.body.appendChild(notification); setTimeout(() => { notification.classList.add('show'); }, 10); setTimeout(() => { notification.classList.remove('show'); setTimeout(() => { notification.remove(); }, 300); }, 4000); }
        
        // Fungsi baru untuk menyimpan URL ke localStorage
        function saveUrls() {
            localStorage.setItem(GSCRIPT_URL_KEY, gscriptUrlInput.value.trim());
            localStorage.setItem(N8N_URL_KEY, n8nUrlInput.value.trim());
            showNotification('URL berhasil disimpan!', 'success');
        }

        // Fungsi baru untuk memuat URL dari localStorage saat halaman dibuka
        function loadUrls() {
            gscriptUrlInput.value = localStorage.getItem(GSCRIPT_URL_KEY) || '';
            n8nUrlInput.value = localStorage.getItem(N8N_URL_KEY) || '';
        }
        
        // Fungsi baru untuk mengirim data ke tujuan tertentu
        async function sendData(url, payload) {
            if (!url) return; // Jika URL kosong, jangan lakukan apa-apa
            try {
                // Untuk Google Script, kita perlu mode no-cors
                const options = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                };
                if (url.includes('google.com')) {
                    options.mode = 'no-cors';
                }
                await fetch(url, options);
                console.log(`Data berhasil dikirim ke ${url.includes('google.com') ? 'Google Sheet' : 'n8n'}`);
            } catch (error) {
                console.error(`Gagal mengirim ke ${url}:`, error);
                throw new Error(`Gagal saat mengirim ke ${url.includes('google.com') ? 'Google Sheet' : 'n8n'}`);
            }
        }
        
        // Listener untuk submit form berita (DIPERBARUI)
        newsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const gscriptUrl = localStorage.getItem(GSCRIPT_URL_KEY);
            const n8nUrl = localStorage.getItem(N8N_URL_KEY);

            if (!gscriptUrl && !n8nUrl) {
                showNotification('Error: Tidak ada URL tujuan (Google Sheet/n8n) yang disimpan.', 'error');
                return;
            }

            document.getElementById('submit-text').textContent = 'Mengirim...';
            document.getElementById('submit-spinner').classList.remove('hidden');
            submitBtn.disabled = true;

            const payload = {
                judul: document.getElementById('judul').value,
                tanggal: document.getElementById('tanggal').value,
                kategori: document.getElementById('kategori').value,
                ringkasan: document.getElementById('ringkasan').value,
                isi: document.getElementById('isi').value,
                thumbnail: document.getElementById('thumbnail').value,
                trending: document.getElementById('trending').checked
            };

            try {
                // Kirim ke Google Sheet dan n8n secara bersamaan
                const gsheetPromise = sendData(gscriptUrl, payload);
                const n8nPromise = sendData(n8nUrl, payload);
                
                await Promise.all([gsheetPromise, n8nPromise]); // Tunggu keduanya selesai

                showNotification('Berita berhasil dikirim!', 'success');
                newsForm.reset();
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                document.getElementById('submit-text').textContent = '+ Tambah Berita';
                document.getElementById('submit-spinner').classList.add('hidden');
                submitBtn.disabled = false;
            }
        });

        saveUrlsBtn.addEventListener('click', saveUrls);
        document.getElementById('reset-btn').addEventListener('click', () => { newsForm.reset(); });
        authenticate();
    });
    </script>
</body>
</html>
