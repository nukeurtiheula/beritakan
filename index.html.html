<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Beritakan - Portal Berita</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');body{font-family:'Inter',sans-serif}.fade-in{animation:fadeIn .5s ease-in-out}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}.trending-card-overlay{background:linear-gradient(to top,rgba(0,0,0,.85),transparent 60%)}</style>
    <script>tailwind.config={darkMode:"class",theme:{extend:{colors:{beritakanRed:"#D32F2F"}}}}</script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <div id="app-container" class="max-w-3xl mx-auto flex flex-col min-h-screen">
        <header class="p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm sticky top-0 z-20 shadow-sm"><div class="flex justify-between items-center"><h1 class="text-2xl font-extrabold text-beritakanRed">Beritakan</h1><p id="user-greeting" class="text-sm text-gray-600 dark:text-gray-400">Selamat Datang!</p></div></header>
        <main class="flex-grow p-4 pb-24">
            <div id="news-container" class="space-y-4 pt-4">
                <p id="loading-message" class="text-center text-gray-500 py-8">Memuat berita...</p>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ======================== GANTI URL INI DENGAN SANGAT TELITI ========================
        // Ganti dengan Production URL dari workflow n8n GET-berita Anda.
        const N8N_FETCH_URL = 'https://rested-on-bullfrog.ngrok-free.app/webhook/beritakan-input';
        // ====================================================================================

        const newsContainer = document.getElementById('news-container');
        const loadingMessage = document.getElementById('loading-message');

        const fetchNewsData = async () => {
            console.log("Mencoba mengambil data dari:", N8N_FETCH_URL);
            
            if (!N8N_FETCH_URL || !N8N_FETCH_URL.includes('/webhook/')) {
                loadingMessage.textContent = 'Error: URL n8n tidak valid. Pastikan itu adalah URL webhook.';
                loadingMessage.className = 'text-center text-red-500 py-8';
                return;
            }

            try {
                const response = await fetch(N8N_FETCH_URL);
                
                // Cek Tipe Konten sebelum parsing
                const contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    // Jika respons bukan JSON, lempar error dengan isi teksnya
                    const responseText = await response.text();
                    console.error("Server tidak mengembalikan JSON. Respons yang diterima:", responseText);
                    throw new Error(`Server tidak mengembalikan JSON. Ini yang diterima: ${responseText.substring(0, 100)}...`);
                }

                if (!response.ok) {
                    throw new Error(`Server merespons dengan status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log("Data mentah diterima:", data);

                // n8n mengembalikan array dari objek, di mana setiap objek memiliki key "json"
                // Kita perlu mengekstrak isi dari "json" tersebut.
                const newsData = data.map(item => item.json);
                console.log("Data setelah diproses:", newsData);

                if (newsData.length === 0) {
                    loadingMessage.textContent = 'Belum ada berita untuk ditampilkan.';
                    return;
                }

                renderNews(newsData);

            } catch (error) {
                console.error("Gagal total:", error);
                loadingMessage.textContent = `Gagal memuat berita: ${error.message}`;
                loadingMessage.className = 'text-center text-red-500 py-8';
            }
        };

        const renderNews = (newsItems) => {
            newsContainer.innerHTML = ''; // Hapus pesan "Memuat berita..."
            newsItems.forEach(item => {
                const card = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 fade-in">
                        <h3 class="text-lg font-bold text-beritakanRed">${item.title || 'Tanpa Judul'}</h3>
                        <p class="text-xs text-gray-500 mb-2">${item.date || ''} â€¢ ${item.category || ''}</p>
                        <img src="${item.thumbnailUrl || 'https://placehold.co/300x150/cccccc/ffffff?text=No+Image'}" alt="${item.title || 'Gambar'}" class="w-full h-40 object-cover rounded-md my-2">
                        <p class="text-sm text-gray-700 dark:text-gray-300">${item.summary || ''}</p>
                    </div>
                `;
                newsContainer.insertAdjacentHTML('beforeend', card);
            });
        };

        // Mulai aplikasi
        fetchNewsData();
    });
    </script>
</body>
</html>
